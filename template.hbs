node-dynamic-acl
==========

Dynamic Access Control List for Node.js to fully control your Roles, Resources, Privileges and Conditions

#Install
```
$ npm install dynamic-acl
```

#Quick Start

```javascript
var Acl = require('../dist').Acl;
var Role = require('../dist').Role;
var Resource = require('../dist').Resource;

var getUserRoleId = function (user) {
return user.roleId;
};

var getResourceId = function (resource) {
return resource.resourceId;
};


var acl = new Acl(getUserRoleId, getResourceId);

acl.addRole(new Role('visitor')) //role without parent
.addRole(new Role('user', 'visitor')) //role with parent role
.addRole(new Role('admin', ['user'])) //role parents can be declared in an array of strings
.addResource(new Resource('page', ['read', 'mark', 'change title'])) // resource = page, privileges = 'read', 'mark'...
.addResource(new Resource('book')) // resource without any privilege, it will take automatically '*'
.build(); //IMPORTANT: builds permission acls before settings access rules

//This function will be used later for specific case
var userCanMarkPage = function (user, page) {
if (user.firstname == 'Timmmmy')
return true;
return false;
};

acl.allow('visitor', 'page', 'read') //allow role 'visitor' to access resource 'page' with privilege 'read' (vistor can read page)
.allow('user', 'page') // allow role 'user' all privileges on resource 'page'
.allow('user', 'page', 'mark', userCanMarkPage) //allow role 'user' privilege 'mark' on resource 'page' with conditions depending on userCanMarkPage result
.deny('user', 'page', 'change title') //deny role 'user' to 'change title' of the 'page'
.allow('admin', 'page', 'change title') //as 'admin' inherits all rights of 'user', we allow 'admin' to access 'page' with privilege 'change title'
.allow('admin', 'book'); //all 'admin' to access all privileges of resource 'book'


var anonymous = {
	roleId: 'visitor'
};
var bob = {
	firstname: 'Bob',
	lastname: 'Marley',
	roleId: 'user'
};

var me = {
	firtname: 'Timmmmy',
	lastname: 'Timmmmy',
	roleId: 'admin'
};

var page1 = {
	id: 'page 1',
	title: 'Go further with node',
	resourceId: 'page'
};

var book = {
	id: 'book 1',
	title: 'Go further with JS',
	resourceId: 'book'
};

console.log('anonymous isAllowed page1:* ' + acl.isAllowed(anonymous, page1));
console.log('anonymous isAllowed page1:read ' + acl.isAllowed(anonymous, page1, 'read'));
console.log('anonymous isAllowed page1:mark ' + acl.isAllowed(anonymous, page1, 'mark'));
console.log('anonymous isAllowed page1:change title ' + acl.isAllowed(anonymous, page1, 'change title'));
console.log('anonymous isAllowed book:* ' + acl.isAllowed(anonymous, book));
console.log('anonymous isAllowed book:sell ' + acl.isAllowed(anonymous, book, 'sell'));            //privilege was not declared previously -> inherit from book:*


console.log('bob isAllowed page1:* ' + acl.isAllowed(bob, page1));
console.log('bob isAllowed page1:read ' + acl.isAllowed(bob, page1, 'read'));
console.log('bob isAllowed page1:mark ' + acl.isAllowed(bob, page1, 'mark'));
console.log('bob isAllowed page1:change title ' + acl.isAllowed(bob, page1, 'change title'));
console.log('bob isAllowed book:* ' + acl.isAllowed(bob, book));
console.log('bob isAllowed book:sell ' + acl.isAllowed(bob, book, 'sell'));            //privilege was not declared previously -> inherit from book:*

console.log('me isAllowed page1:* ' + acl.isAllowed(me, page1));
console.log('me isAllowed page1:read ' + acl.isAllowed(me, page1, 'read'));
console.log('me isAllowed page1:mark ' + acl.isAllowed(me, page1, 'mark'));
console.log('me isAllowed page1:change title ' + acl.isAllowed(me, page1, 'change title'));
console.log('me isAllowed book:* ' + acl.isAllowed(me, book));
console.log('me isAllowed book:sell ' + acl.isAllowed(me, book, 'sell'));            //privilege was not declared previously -> inherit from book:*


```

#API Reference
{{#class name="Acl"}}
	{{>docs}}
{{/class}}
{{#class name="Role"}}
	{{>docs}}
{{/class}}
{{#class name="Resource"}}
	{{>docs}}
{{/class}}
